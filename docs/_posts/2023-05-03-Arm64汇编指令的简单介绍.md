---
layout: post
title: Arm64的汇编指令的简单介绍
date: 2023-05-02 08:00:17 
last_modified_at: 2023-05-03 08:00:17 
tags: [Linux内核]
author: Daniel
math: true
toc: true
description: 这是一篇关于Arm64的汇编指令的简单介绍
---
# Arm64的汇编指令的简单介绍

本文主要是在查看Linux内核中的Arm64架构下的汇编指令时所做的笔记

### Arm64的寄存器

​		Arm64架构有31个通用寄存器，包括PC在内，分别是x0-x30，其中x0到x7寄存器用于参数传递，x0还用于代码段调用之后值的返回。x30(lr)是栈指针寄存器SP，在Arm64架构中，如果使用Xn的方式访问一个寄存器，则说明访问的是一个64位的寄存器，如果使用的是Wn对应的64位寄存器的低32位,Rn方式访问的话，既可以访问64位，也可以访问32位寄存器，由操作数决定。

### 汇编指令

{% raw %}

| 汇编指令 | 使用用例                  | 备注说明                                                     |
| -------- | ------------------------- | ------------------------------------------------------------ |
| mov      | mov x0, #0x1              | 将立即数#0x1移动到x0寄存器中                                 |
| add      | add x0, x1, x2            | 将x1，x2的值相加后保存到x0寄存器中                           |
| sub      | sub x0, x1, x2            | 将x1，x2的值相减后保存到x0寄存器中                           |
| mul      | mul x0, x1, x2            | 将x1，x2的值相乘后保存到x0寄存器中                           |
| sdiv     | sdiv x0, x1, x2           | 将x1，x2的值相除后保存到x0寄存器中                           |
| orr      | orr x0, x1, x2            | 异或运算                                                     |
| str      | str w9, [sp, #0x8]        | 写入运算，将w9写入到[sp, #0x8] 处                            |
| strb     | strb w9, [sp, #7]         | 写入运算，写入低1字节的值                                    |
| ldr      | ldr x0, [x1]              | 读入计算，将[x1]的值写入x0                                   |
| ldrsb    | ldrsb w8, [sp, #7]        | 读入计算，读入低1字节的值                                    |
| stur     |                           | 和str一样                                                    |
| ldur     |                           | 和ldr一样                                                    |
| ldp      | ldp x29, x30, [sp, #0x10] | 出栈指令,取出两个64位空间大小的数值放入x29,x30寄存器中       |
| stp      | stp x29, x30, [sp, #0x10] | 入栈指令，取出x29,x30的值方法一个128位大小的内存中           |
| cbz      | cbz w24, 0x1b6b798f4      | 比较w24操作数是否为零，如果为零则跳转0x1b6b798f4             |
| cbnz     | cbnz w24, 0x1b6b798f4     | 比较w24操作数是否为零，如果不为零则跳转0x1b6b798f4           |
| cmp      | cmp w8, #0x3              | 判断w8, #0x3差值是否为零，若为零，则ZF寄存器为1              |
| cset     |                           |                                                              |
| brk      |                           | 特殊跳转指令                                                 |
| b        | b LBB0_1                  | 跳转到地址（无返回）                                         |
| bl       | bl x20                    | 跳转到某地址（有返回），函数返回地址保持在x30寄存器中        |
| blr      |                           | 有返回跳转                                                   |
| br       |                           | 无返回跳转                                                   |
| ret      |                           | 子程序返回，返回地址在x30寄存器中                            |
| tbz      | tbz w24, #0x6, addr       | w24第6位为零，则跳转地址addr                                 |
| tbnz     |                           | 若不为零，则跳转                                             |
| bic      | BIC R0, R0, #0x1011       | 位清零指令                                                   |
| adr_l    | adr_l dst_reg, symbol     | 将symbol地址加载到dst_reg寄存器中                            |
| dmb      | dmb sy                    | dmb sy 是Arm64汇编指令中的一种内存屏障                       |
| mrs      | mrs Xn, system_register   | 将系统寄存器system_register中的值移动到通用寄存器Xn          |
| b.eq     | b.eq	init_el2          | 在条件码 `Z` 为 1 时跳转到 `init_el2` 标签处执行指令，Z=1的条件是前边CMP比较相等 |
| msr      | msr system_register, Xn   | 将通用寄存器xn的值移动到系统寄存器                           |
| mov_q    | mov_q Xd, imm             | 将一个 64 位数据值（quadword）加载到一个 64 位通用寄存器中   |
|          |                           |                                                              |
|          |                           |                                                              |
|          |                           |                                                              |
|          |                           |                                                              |
|          |                           |                                                              |
|          |                           |                                                              |

{% endraw %}

mov_z, mov_q,mov_d, mov_s 指令中z、q、d、s分别表示下列含义

- `z`: 表示32位的数据类型，例如`w0`、`w1`等通用寄存器中的数据。
- `q`: 表示64位的数据类型，例如`x0`、`x1`等通用寄存器中的数据。
- `d`: 表示64位的浮点数类型，例如`d0`、`d1`等浮点寄存器中的数据。
- `s`: 表示32位的浮点数类型，例如`s0`、`s1`等浮点寄存器中的数据。

{% raw %}

| 符号             | 含义                                                         |
| ---------------- | ------------------------------------------------------------ |
| dcache_inval_poc | 一个标签，表示数据缓存清空函数                               |
| CurrentEL        | CurrentEL是 Armv8-A 架构中的一个系统寄存器，用于记录当前的异常级别（Exception Level） |
| \#CurrentEL_EL2  | 表示异常级别为 EL2                                           |
|                  |                                                              |
|                  |                                                              |
|                  |                                                              |
|                  |                                                              |
|                  |                                                              |
|                  |                                                              |

{% endraw %}



### 参考文章

[arch64/arm64 指令集介绍](ttps://juejin.cn/post/7131295389059121159)

